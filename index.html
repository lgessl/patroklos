<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>An R package pipelining binary classification of survival • patroklos</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="An R package pipelining binary classification of survival">
<meta name="description" content="See README.md.">
<meta property="og:description" content="See README.md.">
<meta property="og:image" content="https://lgessl.github.io/patroklos/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">patroklos</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="patroklos-">patroklos <a class="anchor" aria-label="anchor" href="#patroklos-"></a>
</h1>
</div>
<p><!-- badges: start --></p>
<p><a href="https://github.com/lgessl/patroklos/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/lgessl/patroklos/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></p>
<p><!-- badges: end --></p>
<div class="section level2">
<h2 id="an-r-package-pipelining-binary-classification-of-survival">An R package pipelining binary classification of survival<a class="anchor" aria-label="anchor" href="#an-r-package-pipelining-binary-classification-of-survival"></a>
</h2>
<p>patroklos is pipeline that allows you to define, train, validate, test and analyze models whose final goal it is to predict if an event occurs before or after a pivotal time. It does so for the famous train-validate-test split of your data, where you train and test your models on a training cohort and pick the best validated model and take it over to the test cohort to assess its generalization error on new data.</p>
<div class="section level3">
<h3 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h3>
<p>Make sure you have the <code>devtools</code> package installed, start an R session and then type:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"devtools"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"lgessl/patroklos"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="whats-the-scenario-this-r-package-is-tailored-for">What’s the scenario this R package is tailored for?<a class="anchor" aria-label="anchor" href="#whats-the-scenario-this-r-package-is-tailored-for"></a>
</h3>
<p>patroklos is a good choice for the just mentioned scenario and it is very good choice for the scenario we tailored it for.</p>
<p>Imagine you are given a data set holding information on cancer patients. This data includes a many, many features from a high-throughput measurement like gene-expression levels for hundreds or even thousands of genes (“expression data”) and some other features (“pheno data”). Among the pheno data is survival information in the form of time to event and right censoring. You want to build a binary classifier that takes a subset of your features (excluding the two survival features) as input to predict for a given sample if it faces the event (like progression or death) before or after a certain time.</p>
<p>This tasks involves</p>
<ul>
<li>preprocessing the data,</li>
<li>deciding on an error measure for validation and testing,</li>
<li>training a whole bunch of models and validating them, including tuning their hyperparameters,</li>
<li>assessing the best validated model on the test cohort and</li>
<li>unlocking the test set for all trained models to do some analysis, e.g., how reliably</li>
<li>cross-validated errors estimate the test error.</li>
</ul>
<p>At any point in this sequence, you or your boss may come up with new ideas: training a new model, training the same models on a different data set, testing the models on a different test set or changing the error measure for validation. But you are the boss of this machine learning project and, as such, you need to be flexible and able to integrate new ideas quickly. You may hire a secretary. Or you resort to patroklos.</p>
<p>patroklos will do a big part of the repetitive, administrative work and lets you focus on the statistical and biological part of your work. If there is still bureaucratic work left for you, patroklos at least tells you how to do it.</p>
<p>All in all, patroklos is not the star of the shows. But it plays a key role in it — just like Πάτροκλος in the Iliad: being Achilles’ best friend, his death brings Achilles back to the battlefield helping the Greeks score decisive victories.</p>
</div>
<div class="section level3">
<h3 id="how-does-this-r-package-make-your-life-easier">How does this R package make your life easier?<a class="anchor" aria-label="anchor" href="#how-does-this-r-package-make-your-life-easier"></a>
</h3>
<p>patroklos has three major goals: making integrating</p>
<ul>
<li>new data,</li>
<li>new models with new hyperparameters and</li>
<li>your custom validation and testing</li>
</ul>
<p>into your workflow as effortless as possible and at the same leaving you enough freedom to adapt the pipeline to the needs of your project.</p>
<div class="section level4">
<h4 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h4>
<p>The R6 class <code>Data</code> tells you how to preprocess your data. patroklos also gives you some tools you often need for preprocessing.</p>
</div>
<div class="section level4">
<h4 id="models">Models<a class="anchor" aria-label="anchor" href="#models"></a>
</h4>
<p>patroklos abstracts the data from the models, which you specify in another R6 class, <code>Model</code>. A model typically specifies more than just one combination of hyperparameters that need to be tuned. Concerning model classes and fitting functions, you have full flexibility — you can provide any fitting function as an attribute to a <code>Model</code> as long as its function interface fulfills patroklos’s expectations. If the fitting function generates hyperparameters automatically or tunes hyperparameters internally, that’s totally fine as long it returns a single fit object with validated predictions and a predict method. Again, it is left 100% to the model how it calculates the validated predictions, e.g. by cross validation or out-of-bag predictions. patroklos also provides patroklos-compliant fitting functions out of the box, namely for Gauss, logistic and Cox models by means of the <code>zeroSum</code> package and random forests by means of the <code>ranger</code> package. For every <code>Model</code>, patroklos can tune some model-agnostic hyperparameters itself.</p>
</div>
<div class="section level4">
<h4 id="validation-and-testing">Validation and testing<a class="anchor" aria-label="anchor" href="#validation-and-testing"></a>
</h4>
<p>Validate your models on their training data and test them on some test data for a variety of metrics including (scalar) error measures — precision (under the constraint of a minimum rate of positive predictions a.k.a prevalence), hazard ratio, ROC-AUC, lower and upper bound of the <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>γ</mi><annotation encoding="application/x-tex">\gamma</annotation></semantics></math>-confidence interval of the precision or hazard ratio — with the R6 classes <code>AssScalar</code>. For many models you first need to threshold their output before you have a binary classifier at hand. The R6 class <code>Ass2d</code>, which, for every possible threshold, plots one metric of binary classifier against another — e.g. prevalence against precision — guides in thresholding. In testing, you often want to compare your picked model to a benchmark model — no problem, just include its output into your data and specify a <code>Model</code> for it with the help of the <code><a href="reference/projection_on_feature.html">projection_on_feature()</a></code> fitter.</p>
<p>#### Meta analysis</p>
<p>After testing the picked model on a test cohort, unlock it for more models, plot validation versus test error, group models by their hyperparameters and find out which hyperparameters come with systematic flaws in validation and notoriously high test errors. Exclude problematic models from the set of <code>Model</code>s in the future. <code><a href="reference/val_vs_test.html">val_vs_test()</a></code> is your friend here.</p>
</div>
</div>
<div class="section level3">
<h3 id="more-tweaks-by-patroklos">More tweaks by patroklos<a class="anchor" aria-label="anchor" href="#more-tweaks-by-patroklos"></a>
</h3>
<div class="section level4">
<h4 id="storing-and-reading-in-models">Storing and reading in models<a class="anchor" aria-label="anchor" href="#storing-and-reading-in-models"></a>
</h4>
<p>Training and assessing so many models takes a lot of time. So as your project evolves over time, you don’t want to fit your models again and again. To this end, patroklos heavily resorts to storing the models and reading them in on demand. Typically you would also “store” the <code>Model</code>, <code>AssScalar</code> and <code>Ass2d</code> objects, either as an .rds file or, more typically, their initialization in an R script.</p>
</div>
<div class="section level4">
<h4 id="integrating-models-into-another-model">Integrating models into another model<a class="anchor" aria-label="anchor" href="#integrating-models-into-another-model"></a>
</h4>
<p>Some of the features of a <code>Model</code> may be the output of another model, e.g., from a gene-expression signature. We call the latter model, whose output becomes the new feature, an <em>early</em> and the former model, which experiences the output of the early model as a feature, the <em>late</em> model. If the early model was trained on another data set, this is just an ordinary feature (which might have issues with batch effects) — easy. If, however, you want to train the early model on the same data set as the late model, things become tricky and you might want to have a look at <code><a href="reference/greedy_nestor.html">greedy_nestor()</a></code> and <code><a href="reference/long_nestor.html">long_nestor()</a></code>.</p>
</div>
</div>
<div class="section level3">
<h3 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h3>
<p>See patroklos in action in the <a href="https://github.com/lgessl/master-thesis" class="external-link">repository of my master thesis</a>.</p>
</div>
<div class="section level3">
<h3 id="using-your-own-models">Using your own models<a class="anchor" aria-label="anchor" href="#using-your-own-models"></a>
</h3>
<p>To fit into the pipeline, models and their related functions must meet certain requirements. Typically in R, training and assessing a model involves</p>
<ul>
<li>a function that fit_obj the model to training data, optionally tunes hyperparameters in a cross validation, e.g., and returns</li>
<li>an S3 object representing the fit. Often this object holds some kind of validated predictions like those from a cross validation or out-of-bag predictions in the case of a random forest. This S3 object has a</li>
<li>
<code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> method that predicts on new data.</li>
</ul>
<p>We will refer to them as <em>fitter</em>, <em>fit object</em> and <em>predict method</em> in the following.</p>
<p>For many packages, these three components already fulfill the expectations patroklos has or you can at least use part of patroklos’s functionality with them. To be able to access patroklos’s full power for a model, you may need to wrap the fitter and the predict method and to modify the fit object to make them patroklos-compatible. There are multiple definitions of patroklos-compatibility we will elaborate on below.</p>
<div class="section level4">
<h4 id="patroklos-compliant-predict-method">patroklos-compliant predict method<a class="anchor" aria-label="anchor" href="#patroklos-compliant-predict-method"></a>
</h4>
<p>A <em>patroklos-compliant predict method</em> declares three parameters,</p>
<ul>
<li>
<code>object</code>: the fit object,</li>
<li>
<code>newx</code>: prediction data as a named numeric matrix, samples correspond to named rows, features to named columns, and</li>
<li>
<code>...</code>: additional parameters (often passed on to the wrapped predict method).</li>
</ul>
<p>It returns a named numeric vector of predictions from <code>newx</code>.</p>
</div>
<div class="section level4">
<h4 id="patroklos-compliant-fitter">patroklos-compliant fitter<a class="anchor" aria-label="anchor" href="#patroklos-compliant-fitter"></a>
</h4>
<p>A <em>patroklos-compliant fitter</em> declares three parameters,</p>
<ul>
<li>
<code>x</code>: training data as a named numeric matrix, samples correspond to named rows, features to named columns. It has an attribute <code>li_var_suffix</code>, i.e. columns in <code>x</code> with the suffix <code>li_var_suffix</code> are designated for late integration and the fitter may use this information.</li>
<li>
<code>y</code>: binary response as a named numeric vector. Its names must match the row names of <code>x</code>.</li>
<li>
<code>...</code>: additional parameters (often passed on to the wrapped fitter).</li>
</ul>
<p>It returns an S3 object with a patroklos-compliant predict method.</p>
</div>
<div class="section level4">
<h4 id="patroklos-compliant-fitter-with-validated-predictions">patroklos-compliant fitter with validated predictions<a class="anchor" aria-label="anchor" href="#patroklos-compliant-fitter-with-validated-predictions"></a>
</h4>
<p>A <em>patroklos-compliant fitter with validated predictions</em> is a patroklos-compliant fitter whose S3 return value has an attribute <code>val_predict</code>, a numeric vector holding some form of validated predictions. Validated predictions are predictions made on independent data like cross-validated (CV) predictions or out-of-bag (OOB) predictions in the case of random forests.</p>
</div>
<div class="section level4">
<h4 id="patroklos-compliant-fitter-with-cv-tuning">patroklos-compliant fitter with CV tuning<a class="anchor" aria-label="anchor" href="#patroklos-compliant-fitter-with-cv-tuning"></a>
</h4>
<p>A <em>patroklos-compliant fitter with cross-validation tuning</em> is a patroklos-compliant fitter whose return value has the attributes</p>
<ul>
<li>
<code>val_predict_list</code>: list of numeric vectors holding cross-validated predictions for every hyperparameter <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>,</li>
<li>
<code>lambda</code>: numeric or character vector of the hyperparameters <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>.</li>
</ul>
<p>While a <em>patroklos-compliant fitter with validated predictions</em> only performs a cross validation for one combination of hyperparameters, a <em>patroklos-compliant fitter with CV tuning</em> performs a cross validation for multiple values of a hyperparameter <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math> (which may be a tuple, not just a scalar). The embraced word “scalar” is a clear constraint here and it may be worth relaxing the definition from a search line to a search grid for hyperparameters in the future (which of course involves modifying those functions requiring a <em>patroklos-compliant fitter with CV tuning</em>).</p>
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing patroklos</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Lukas Gessl <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Lukas Gessl.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
